- cache [@area.class.to_s,@area.id,@update.updated_at] do
  .page-header
    %h3
      = @area.name
      - if @area.class.to_s == 'StateShape'
        %small.dropdown
          %button.btn.btn-default.dropdown-toggle{'type' => "button", 'id' => "dropdownCities", 'data-toggle' => "dropdown", 'aria-haspopup' => "true", 'aria-expanded' => "true"}
            Cidade
            %span.caret
          %ul.dropdown-menu{ 'aria-labelledby' => "dropdownCities"}
            - @area.cities.order(:nm_municip).each do |c|
              %li
                %a{:href => "/segments/#{c.gid}"}= c.name
      %small= "#{t('updated-at')} #{ @update.updated_at.strftime('%d/%m/%Y %H:%M')}"
  #accordion.panel-group{:role => "tablist", 'aria-multiselecttable' => "true"}
    - if @area.segments.drivable.disconnected.size > 0
      .panel.panel-default
        #disconnected.panel-heading{:role => "tab"}
          %h4.panel-title
            %a{:role => "button", 'data-toggle' => "collapse", 'data-parent' => "#accordion", :href => "#disconnected-body", 'aria-expanded' => "true", 'aria-controls' => "disconnected-body"}
              Segmentos desconectados
              %small ou com convers&otilde;es desativadas
              %span.badge= @area.segments.drivable.disconnected.size
        #disconnected-body.panel-collapse.collapse{:role => "tabpanel", 'arialabelledby' => "disconnected"}
          %table.table.table-condensed.table-hover
            %thead
              %tr
                %th.text-center{:width => "100", 'data-toggle' => "tooltip", 'data-placement' => "top", :title => "Quantidade de segmentos próximos com problemas semelhantes"}= t('density')
                %th Tipo
                %th Localiza&ccedil;&atilde;o do Segmento
            %tbody
              - @area.segments.drivable.disconnected.order('dc_density desc').each do |segment|
                %tr
                  %td.text-center= segment.dc_density
                  %td= roadtype_name(segment.roadtype)
                  %td
                    %a{:href => "https://www.waze.com/pt-BR/editor/?zoom=5&lat=#{segment.latitude}&lon=#{segment.longitude}&segments=#{segment.id}", :target => 'WME'}= segment.location
    - if @area.segments.weird_level.size > 0
      .panel.panel-default
        #level.panel-heading{:role => "tab"}
          %h4.panel-title
            %a{:role => "button", 'data-toggle' => "collapse", 'data-parent' => "#accordion", :href => "#level-body", 'aria-expanded' => "true", 'aria-controls' => "level-body"}
              Segmentos com eleva&ccedil;&otilde;es "exageradas"
              %span.badge= @area.segments.weird_level.size
        #level-body.panel-collapse.collapse{:role => "tabpanel", 'arialabelledby' => "level"}
          %table.table.table-condensed.table-hover
            %thead
              %tr
                %th.text-center{:width => '100'} Eleva&ccedil;&atilde;o
                %th Localiza&ccedil;&atilde;o do Segmento
            %tbody
              - @area.segments.weird_level.order("level desc").each do |segment|
                %tr
                  %td.text-center= segment.level
                  %td
                    %a{href: "https://www.waze.com/pt-BR/editor/?zoom=5&lat=#{segment.latitude}&lon=#{segment.longitude}&segments=#{segment.id}", target: 'WME'}= segment.location
    - if @area.segments.no_name.size > 0
      .panel.panel-default
        #noname.panel-heading{:role => "tab"}
          %h4.panel-title
            %a{:role => "button", 'data-toggle' => "collapse", 'data-parent' => "#accordion", :href => "#noname-body", 'aria-expanded' => "true", 'aria-controls' => "noname-body"}
              Segmentos sem nome
              %span.badge= @area.segments.no_name.size
        #noname-body.panel-collapse.collapse{:role => "tabpanel", 'arialabelledby' => "noname"}
          %table.table.table-condensed.table-hover
            %thead
              %tr
                %th.text-center{:width => '100'} ID
                %th.text-center Tipo
                %th Município
                %th &Uacute;ltima edi&ccedil;&atilde;o
                %th Editor
            %tbody
              - @area.segments.no_name.order("last_edit_on").each do |segment|
                %tr
                  %td
                    %a{href: "https://www.waze.com/pt-BR/editor/?zoom=5&lat=#{segment.latitude}&lon=#{segment.longitude}&segments=#{segment.id}", target: 'WME'}= segment.id
                  %td= roadtype_name(segment.roadtype)
                  %td= segment.city.nm_municip
                  %td= segment.last_edit_on.strftime('%d/%m/%Y %H:%M')
                  %td= "#{segment.editor.username}(#{segment.editor.rank})"
    - if @area.segments.important.without_speed.size > 0
      .panel.panel-default
        #without-speed.panel-heading{:role => "tab"}
          %h4.panel-title
            %a{:role => "button", 'data-toggle' => "collapse", 'data-parent' => "#accordion", :href => "#without-speed-body", 'aria-expanded' => "true", 'aria-controls' => "without-speed-body"}
              Segmentos importantes sem velocidade
              %span.badge= @area.segments.important.without_speed.size
        #without-speed-body.panel-collapse.collapse{:role => "tabpanel", 'arialabelledby' => "without-speed"}
          %table.table.table-condensed.table-hover
            %thead
              %tr
                %th Tipo
                %th Localiza&ccedil;&atilde;o do Segmento
            %tbody
              - @area.segments.important.without_speed.order("roadtype").each do |segment|
                %tr
                  %td= roadtype_name(segment.roadtype)
                  %td
                    %a{:href => "https://www.waze.com/pt-BR/editor/?zoom=5&lat=#{segment.latitude}&lon=#{segment.longitude}&segments=#{segment.id}", :target => 'WME'}= segment.location
    - if @area.segments.where(roadtype: 15).size > 0
      .panel.panel-default
        #ferry.panel-heading{:role => "tab"}
          %h4.panel-title
            %a{:role => "button", 'data-toggle' => "collapse", 'data-parent' => "#accordion", :href => "#ferry-body", 'aria-expanded' => "true", 'aria-controls' => "ferry-body"}
              = t('ferries')
              %span.badge= @area.segments.where(roadtype: 15).size
        #ferry-body.panel-collapse.collapse{:role => "tabpanel", 'arialabelledby' => "ferry"}
          %table.table.table-condensed.table-hover
            %thead
              %tr
                %th Tipo
                %th Localiza&ccedil;&atilde;o do Segmento
            %tbody
              - @area.segments.where(roadtype: 15).order("roadtype").each do |segment|
                %tr
                  %td= roadtype_name(segment.roadtype)
                  %td
                    %a{:href => "https://www.waze.com/pt-BR/editor/?zoom=5&lat=#{segment.latitude}&lon=#{segment.longitude}&segments=#{segment.id}", :target => 'WME'}= segment.location
